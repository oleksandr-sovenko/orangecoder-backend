<!--
filesystem.f7.html
Copyright (C) 2020 Oleksandr Sovenko (info@oleksandrsovenko.com)

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->

<template>
    <div class="page" data-name="filesystem">
        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="if-not-md">{{_t 'Back'}}</span>
                    </a>
                </div>
                <div class="title">{{_t 'File System'}}</div>
            </div>
        </div>
        <div class="page-content">
            <div class="block-title">{{_t 'List of files and directories'}}</div>

            <div class="data-table data-table-init card">
                <div class="card-header">
                    <div class="data-table-links">
                        <a class="link">
                        	{{_t 'Add Directory'}}
                        </a>

                        <a class="link">
                            {{_t 'Add File'}}
                        </a>

                        <a class="link">
                            {{_t 'Upload File'}}
                        </a>

                        <!--div>
                            /<a class="text-color-black" href="#">var</a>/<a class="text-color-black" href="#">lib</a>/<a class="text-color-black" href="#">www</a>
                        </div-->
                    </div>
                    <!--div class="data-table-actions">
                        <a class="link icon-only">
                            <i class="icon f7-icons if-not-md">sort</i>
                            <i class="icon material-icons md-only">sort</i>
                        </a>
                        <a class="link icon-only">
                            <i class="icon f7-icons if-not-md">more_vertical_round</i>
                            <i class="icon material-icons md-only">more_vert</i>
                        </a>
                    </div-->
                </div>
                <div class="card-content">
                    <table>
                         <thead>
                            <tr>
                                <th class="label-cell"></th>
                                <th class="label-cell">{{_t 'Name'}}</th>
                                <th class="label-cell">{{_t 'Date'}}</th>
                                <th class="label-cell">{{_t 'Size'}}</th>
                                <th class="label-cell">{{_t 'Action'}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each filesystem.files}}
                                <tr data-name="{{name}}" data-type="{{type}}" class="fm-item">
                                    <td class="label-cell" nowrap>
                                        <i class="material-icons">{{js ' this.type == "dir" ? "folder_open" : "insert_drive_file" '}}</i>
                                    </td>
                                    <td class="label-cell" width="100%">{{name}}</td>
                                    <td class="label-cell" nowrap>
                                        {{#js_if ' this.name != ".." '}}
                                            {{date}}
                                        {{/js_if}}
                                    </td>
                                    <td class="label-cell" nowrap>
                                        {{#js_if ' this.name != ".." '}}
                                            {{size}}
                                        {{/js_if}}
                                    </td>
                                    <td class="actions-cell" nowrap>
                                        {{#js_if ' this.name != ".." '}}
                                            {{#js_if ' this.type == "file" '}}
                                                <a class="link icon-only">
                                                    <i class="material-icons">cloud_download</i>
                                                </a>
                                            {{/js_if}}
                                            <a class="link icon-only" @click="deleteItem">
                                                <i class="material-icons">delete</i>
                                            </a>
                                        {{/js_if}}
                                    </td>
                                </tr>
                            {{else}}
                                <tr>
                                    <td colspan="6" class="text-align-center">{{_t 'No files and directories yet'}}</td>
                                </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
                <div class="card-footer"></div>
            </div>
        </div>
    </div>
</template>

<script>
export default {
    style: `
        .fm-item {
            cursor: pointer;
        }

        .fm-item .material-icons {
            color: var(--f7-theme-color);
        }
    `,
    methods: {
        deleteItem(el) {
            var self = this,
                tr   = self.$$(el.target).closest('tr'),
                name = tr.data('name'),
                type = tr.data('type'),
                path = name;

            self.$app.dialog.confirm('Remove ' + name + '?', 'Delete', function() {
                self.$app.request({
                    url: self.$app.data.url + '/filesystem/item/' + path,
                    contentType: 'application/json',
                    method: 'DELETE',
                    dataType: 'json',
                    success: function(data, status, xhr) {
                        self.$app.methods.filesystem.files(function(files) {
                            self.filesystem.files = files;
                            self.$update();
                        });
                    }
                });
            });
        }
    },

    data: function() {
        return {
            filesystem: {
                files: this.$app.data.filesystem.files
            }
        }
    },
};
</script>